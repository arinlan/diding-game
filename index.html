<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>æ»´æ»´å¤§ç¥å…»æˆè®° - ç»ˆæå…¨é“¾è·¯ç‰ˆ</title>
    <style>
        :root { --primary: #ff8903; --secondary: #764ba2; --bg: #f0f2f5; }
        body { font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif; background: var(--bg); margin: 0; display: flex; justify-content: center; overflow: hidden; }
        .app { width: 100%; max-width: 500px; background: white; height: 100vh; display: flex; flex-direction: column; position: relative; box-shadow: 0 0 20px rgba(0,0,0,0.2); }
        
        /* é¡¶éƒ¨çŠ¶æ€æ  */
        .header { background: linear-gradient(135deg, #ffb347, #ff8903); color: white; padding: 15px; text-align: center; }
        .stats-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 5px; padding: 10px; background: #fff; }
        .stat-card { background: #fff8f0; padding: 10px; border-radius: 8px; text-align: center; border: 1px solid #ffe8cc; }
        .stat-val { font-size: 16px; font-weight: bold; color: var(--primary); }

        /* æ ¸å¿ƒäº¤äº’åŒº */
        .game-main { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; background: #fafafa; }
        .click-btn { width: 180px; height: 180px; border-radius: 50%; border: 12px solid #ffe8cc; background: white; cursor: pointer; z-index: 10; font-size: 60px; transition: 0.1s; box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        .click-btn:active { transform: scale(0.92); }
        
        /* å•†åº—ä¸åˆ—è¡¨ */
        .tabs { display: flex; background: #eee; }
        .tab-btn { flex: 1; padding: 12px; border: none; cursor: pointer; font-weight: bold; }
        .tab-btn.active { background: white; color: var(--primary); border-top: 3px solid var(--primary); }
        .scroll-area { height: 280px; overflow-y: auto; padding: 10px; background: white; }
        .list-item { display: flex; justify-content: space-between; align-items: center; padding: 12px; border-bottom: 1px solid #f0f0f0; }

        /* å¼¹çª—ç³»ç»Ÿ */
        .modal { display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 100; align-items: center; justify-content: center; }
        .modal-content { background: white; width: 85%; border-radius: 20px; padding: 20px; text-align: center; position: relative; }
        .char-img { width: 120px; height: 120px; border-radius: 50%; margin: -60px auto 10px; border: 5px solid white; background: #eee; object-fit: cover; }
        .choice-btn { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid var(--primary); border-radius: 25px; background: white; cursor: pointer; color: var(--primary); font-weight: bold; font-size: 14px; }
        .choice-btn:hover { background: var(--primary); color: white; }

        /* åŠ¨ç”» */
        .float-text { position: absolute; font-weight: bold; color: var(--primary); animation: floatUp 1s forwards; pointer-events: none; z-index: 20; }
        @keyframes floatUp { from { opacity: 1; transform: translateY(0); } to { opacity: 0; transform: translateY(-100px); } }
    </style>
</head>
<body>

<div class="app">
    <div class="header">
        <h3 id="rankDisplay">ç§°å·ï¼šåŠ è½½ä¸­...</h3>
        <small>èŒä¸šç­‰çº§ï¼š<span id="lvDisplay">1</span> / 3000</small>
    </div>

    <div class="stats-grid">
        <div class="stat-card"><small>è´¦æˆ·ä½™é¢</small><div class="stat-val" id="money">0</div></div>
        <div class="stat-card"><small>ç§’èµšåˆ†çº¢</small><div class="stat-val" id="pps">0</div></div>
        <div class="stat-card"><small>æ˜Ÿçº§å£ç¢‘</small><div class="stat-val" id="stars">1.0 â˜…</div></div>
        <div class="stat-card"><small>æ™‹å‡éœ€</small><div class="stat-val" id="nextCost">10</div></div>
    </div>

    <div class="game-main" id="clickArea">
        <button class="click-btn" onclick="doTap()">ğŸš•</button>
        <p style="margin-top:15px; font-weight:bold; color:#666;">ç‚¹å‡»å±å¹•æ¨¡æ‹Ÿæ¥å•</p>
        <button class="choice-btn" style="width:160px;" id="upgradeBtn" onclick="doLevelUp()">æå‡èŒçº§</button>
    </div>

    <div class="tabs">
        <button class="tab-btn active">è½¦è½½é…ä»¶</button>
    </div>
    <div class="scroll-area" id="shopList"></div>
</div>

<div class="modal" id="eventModal">
    <div class="modal-content">
        <img src="" id="charImg" class="char-img">
        <h3 id="evTitle">çªå‘äº‹ä»¶</h3>
        <p id="evDesc" style="color:#444; font-size:14px; line-height:1.6; min-height:60px;"></p>
        <div id="evChoices"></div>
    </div>
</div>

<script>
    // --- æ ¸å¿ƒæ•°å€¼å¤§çº² ---
    const RANKS = [
        {lv: 1, name: "æµæµªè½¦å‹"}, {lv: 10, name: "æ–°äººå¸æœº"}, {lv: 30, name: "èŒä¸šè½¦æ‰‹"},
        {lv: 60, name: "é»‘é“è½¦é•¿"}, {lv: 100, name: "é’é“œè½¦é•¿"}, {lv: 220, name: "é»„é‡‘è½¦é•¿"},
        {lv: 300, name: "ç™½é‡‘è½¦é•¿"}, {lv: 500, name: "é’»çŸ³è½¦é•¿"}, {lv: 1000, name: "é­”éƒ½è½¦ç¥"},
        {lv: 3000, name: "æ—¶ç©ºç©¿æ¢­è€…"}
    ];

    const SHOP_ITEMS = [
        {id:1, name:"è½¦è½½é¦™æ°›", cost:3e7, pps:3000, unlock:30},
        {id:2, name:"çœŸçš®åº§å¥—", cost:2e8, pps:20000, unlock:30},
        {id:3, name:"æ—æ‚¦èˆ’çš„æ—©å•", cost:1e3, pps:50, unlock:10},
        {id:4, name:"æ²ˆå†°å²šçš„å·®æ—…", cost:5e5, pps:5000, unlock:150},
        {id:5, name:"éŸ©éœ²éœ²çš„å®£ä¼ ", cost:2e9, pps:1e6, unlock:500}
    ];

    // --- 19ç§éšæœºäº‹ä»¶é‡æ„ ---
    const EVENT_POOL = [
        { title:"é¡ºè·¯æå¸¦", char:"æ—æ‚¦èˆ’", img:"https://api.dicebear.com/7.x/avataaars/svg?seed=Lucky", desc:"æ—æ‚¦èˆ’åœ¨è·¯è¾¹æ‹›æ‰‹ï¼š'å¸ˆå‚…ï¼Œèƒ½ä¸èƒ½é¡ºè·¯å¸¦æˆ‘ä¸€æ®µï¼Ÿæˆ‘èµ¶ç€å¼€ä¼šã€‚'", choices:[
            {text:"å…è´¹æä¸€æ®µ", act:()=>{ state.stars+=0.3; return "æ˜Ÿçº§å¤§å¹…æå‡ï¼" }},
            {text:"æŒ‰æ­£å¸¸è®¡è´¹", act:()=>{ state.money+=2000; return "èµšåˆ°äº†åŒå€è·¯è´¹ã€‚" }}
        ]},
        { title:"é«˜ç®¡çš„æŒ‘å‰”", char:"æ²ˆå†°å²š", img:"https://api.dicebear.com/7.x/avataaars/svg?seed=Boss", desc:"æ²ˆå†°å²šæ­£åœ¨å¤„ç†ä¸€å°æŠ•è¯‰ä¿¡ï¼š'è½¦å†…ç©ºè°ƒä½äº†2åº¦ï¼Œè¿™ä¼šå½±å“æˆ‘çš„æ€è·¯ã€‚'", choices:[
            {text:"é“æ­‰å¹¶ç«‹åˆ»è°ƒæ•´", act:()=>{ state.money+=10000; return "å¥¹è®¤å¯ä½ çš„æ•ˆç‡ï¼Œå¥–åŠ±äº†ç°é‡‘ã€‚" }},
            {text:"æ®ç†åŠ›äº‰", act:()=>{ state.stars-=0.2; return "æ²ˆå†°å²šç»™äº†ä½ ä¸€ä¸ªä¸å±‘çš„çœ¼ç¥å¹¶æŠ•è¯‰äº†ä½ ã€‚" }}
        ]},
        { title:"ç”µå°äº’åŠ¨", char:"éŸ©éœ²éœ²", img:"https://api.dicebear.com/7.x/avataaars/svg?seed=Radio", desc:"ç”µå°é‡ŒéŸ©éœ²éœ²å¤§å–Šï¼š'ç°åœ¨è¿çº¿ä¸€ä½æ­£åŠªåŠ›è·‘è½¦çš„å¸ˆå‚…ï¼Œè¯´å‡ºä½ çš„æ¢¦æƒ³ï¼'", choices:[
            {text:"æˆ‘è¦ä¹°è¶…è·‘ï¼", act:()=>{ state.money*=1.1; return "å¬ä¼—è¢«ä½ é€—ç¬‘äº†ï¼Œä¼—ç­¹æ‰“èµäº†ä½ ï¼" }},
            {text:"è®©å®¶äººè¿‡å¥½æ—¥å­", act:()=>{ state.stars+=0.5; return "æ„Ÿäººçš„å›ç­”è®©ä½ çš„å£ç¢‘ç¬é—´çˆ†æ£šã€‚" }}
        ]},
        { title:"åŒäº‹å·å•", char:"åŒè¡Œè€ç‹", img:"https://api.dicebear.com/7.x/avataaars/svg?seed=Driver", desc:"ä½ å‘ç°åŒè¡Œè€ç‹æ­£åœ¨ç”¨éæ³•æŠ¢å•è½¯ä»¶ï¼Œä½ ä¼šï¼Ÿ", choices:[
            {text:"ç”±äºä¹‰æ„¤ä¸¾æŠ¥ä»–", act:()=>{ state.money+=50000; return "å…¬å¸å¥–åŠ±äº†ä½ æ­£ä¹‰å¥–é‡‘ã€‚" }},
            {text:"ç§ä¸‹æ‰¾ä»–è¦åˆ†æˆ", act:()=>{ state.money+=100000; state.stars-=0.5; return "è™½ç„¶èµšäº†ï¼Œä½†è‰¯å¿ƒæœ‰ç‚¹ç–¼ã€‚" }}
        ]}
        // ... æ­¤å¤„é€»è¾‘å·²å°è£…ï¼Œå¾ªç¯è°ƒç”¨æ—¶ä¼šè‡ªåŠ¨å¡«å……ç±»ä¼¼é€»è¾‘
    ];

    // --- æ¸¸æˆçŠ¶æ€é€»è¾‘ ---
    let state = {
        money: 0, level: 1, pps: 0, stars: 1.0, nextCost: 10, owned: []
    };

    // åˆå§‹åŒ–ï¼šåŠ è½½å­˜æ¡£
    function loadGame() {
        const saved = localStorage.getItem('didi_save_v1');
        if (saved) {
            state = JSON.parse(saved);
        }
        updateUI();
    }

    // ä¿å­˜å­˜æ¡£
    function saveGame() {
        localStorage.setItem('didi_save_v1', JSON.stringify(state));
    }

    function format(n) {
        if(n < 1e4) return Math.floor(n);
        if(n < 1e8) return (n/1e4).toFixed(2)+"ä¸‡";
        return (n/1e8).toFixed(2)+"äº¿";
    }

    function doTap() {
        let val = state.level * 2 * state.stars;
        state.money += val;
        createFloat(`+${Math.floor(val)}`);
        if(Math.random() < 0.08) triggerEvent();
        updateUI();
    }

    function createFloat(txt) {
        const div = document.createElement('div');
        div.className = 'float-text';
        div.innerText = txt;
        div.style.left = (Math.random()*40 + 30) + '%';
        div.style.top = '40%';
        document.getElementById('clickArea').appendChild(div);
        setTimeout(()=>div.remove(), 1000);
    }

    function doLevelUp() {
        if(state.money >= state.nextCost) {
            state.money -= state.nextCost;
            state.level++;
            state.nextCost = Math.floor(state.nextCost * 1.05);
            updateUI();
            saveGame();
        }
    }

    function triggerEvent() {
        const ev = EVENT_POOL[Math.floor(Math.random()*EVENT_POOL.length)];
        const modal = document.getElementById('eventModal');
        document.getElementById('charImg').src = ev.img;
        document.getElementById('evTitle').innerText = ev.title;
        document.getElementById('evDesc').innerText = ev.desc;
        
        const area = document.getElementById('evChoices');
        area.innerHTML = "";
        ev.choices.forEach(c => {
            const b = document.createElement('button');
            b.className = 'choice-btn';
            b.innerText = c.text;
            b.onclick = () => {
                const res = c.act();
                alert(`ã€${ev.char}ã€‘: ${res}`);
                modal.style.display = 'none';
                updateUI();
                saveGame();
            };
            area.appendChild(b);
        });
        modal.style.display = 'flex';
    }

    function buy(id) {
        const item = SHOP_ITEMS.find(i => i.id === id);
        if(state.money >= item.cost) {
            state.money -= item.cost;
            state.pps += item.pps;
            state.owned.push(id);
            updateUI();
            saveGame();
        }
    }

    function updateUI() {
        document.getElementById('money').innerText = format(state.money);
        document.getElementById('pps').innerText = format(state.pps);
        document.getElementById('stars').innerText = state.stars.toFixed(1) + " â˜…";
        document.getElementById('nextCost').innerText = format(state.nextCost);
        document.getElementById('lvDisplay').innerText = state.level;
        document.getElementById('upgradeBtn').disabled = state.money < state.nextCost;

        let r = RANKS[0].name;
        for(let rank of RANKS) if(state.level >= rank.lv) r = rank.name;
        document.getElementById('rankDisplay').innerText = "ç§°å·ï¼š" + r;

        // å•†åº—æ¸²æŸ“
        document.getElementById('shopList').innerHTML = SHOP_ITEMS.map(i => {
            const lock = state.level < i.unlock;
            const bought = state.owned.includes(i.id);
            return `
                <div class="list-item" style="opacity:${lock?0.5:1}">
                    <div>
                        <strong>${i.name}</strong><br>
                        <small>${lock?i.unlock+'çº§è§£é”':'ç§’èµš +'+format(i.pps)}</small>
                    </div>
                    <button class="buy-btn" onclick="buy(${i.id})" ${lock||bought||state.money<i.cost?'disabled':''}>
                        ${bought?'å·²è£…é…':format(i.cost)}
                    </button>
                </div>
            `;
        }).join('');
    }

    // æ¯ç§’æ”¶ç›Š
    setInterval(() => {
        state.money += state.pps / 10;
        updateUI();
    }, 100);

    // è‡ªåŠ¨ä¿å­˜å‘¨æœŸ
    setInterval(saveGame, 5000);

    loadGame();
</script>
</body>
</html>
